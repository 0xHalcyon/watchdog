$def with (petition, emailform, contacts, providers, loadcontactsform=None)

$var title: Share your petition

<script>
function checkAll(){
    cbs = document.getElementsByName('contacts');
    checked = document.getElementsByName('selectall')[0].checked;
    for (i in cbs){
        cbs[i].checked = checked;
    } 
}
function fillTo(){
    cbs = document.getElementsByName('contacts');
    to_addresses = ""
    for (i=0; i< cbs.length; i++){
        if (cbs[i].checked){
            to_addresses += cbs[i].value + ", "
        }
    }
    to_field = document.getElementsByName('emails')[0]
    to_field.value = to_addresses;
}
</script>

<h2>Share <a href='/c/$petition.id'>$petition.title</a></h2>

<form name='contactform' method='POST' action='/c/$petition.id/share'>
$if not emailform.valid: <p class="error">Please try again after fixing the problems highlighted below:</p>
<fieldset id="sharepetition">
    <label for="emails">To:</label>
    $:emailform.emails.render()
    <label for="subject">Subject:</label>
    $:emailform.subject.render()
    <label for="body">Message:</label>
    $:emailform.body.render()
    <input type="hidden" name="pid" value="$petition.id">
    <button tabindex="4" type="submit">Send</button>
</fieldset>
</form>

$var sidebar:
    $if loadcontactsform:
        <form id="loadcontacts" name="loadcontacts" method="POST" action='/u/import_contacts' >
            <p>Enter your $providers email address to load contacts.</p>
            $:loadcontactsform.email.render()
            $:loadcontactsform.provider.render()
            <input type="hidden" name="pid" value="$petition.id">
            <button type="submit">Load contacts</button>
        </form>
    $if contacts:
        <p class='select-all'>
            <input type="checkbox" name="selectall" value='all' onclick='checkAll();fillTo()' />Select all ($len(contacts) contacts)</p>
        <div class='contacts-listing'>
            <ul>
            $for c in contacts:
                <li><input type='checkbox' name='contacts' value='$c.email' onclick='fillTo()'/><b>$c.name</b></br> $c.email</li>
            </ul>    
        </div>

</div>
